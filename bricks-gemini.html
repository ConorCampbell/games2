<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brick Breaker</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <!-- Google Font: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a1a1a; /* Dark background */
            color: #f8f9fa;
            overflow: hidden; /* Prevent scrolling on mobile */
        }

        .game-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 1rem 0;
            display: flex;
            flex-direction: column;
            height: 100vh; /* Full viewport height */
        }

        .game-container .row {
            --bs-gutter-x: 0;
        }

        /* .game-canvas-container::before{
            position: absolute;
            width: 100%;
            height: 100%;
            inset: 0;
            z-index: 0;
            background-size: cover;
            background-position: center;
            filter: blur(8px) brightness(0.6);
            background-image: url('static/img/bricks-gemini.jpg');

        } */
        .info-bar {
            flex-shrink: 0; /* Prevent info bar from shrinking */
            font-size: 1.1rem;
            font-weight: 600;
        }

        .info-bar .col {
            text-align: center;
        }

        .info-bar .col:first-child {
            text-align: left;
        }
        
        .info-bar .col:last-child {
            text-align: right;
        }

        #gameCanvas {
            background: #000;
            border-radius: 0.5rem;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.2); /* Rich visual glow */
            width: 100%; /* Make canvas responsive */
            height: auto;
            max-height: calc(100vh - 150px); /* Adjust based on info/control height */
            aspect-ratio: 4 / 3; /* Maintain 4:3 aspect ratio */
            /* cursor: none; */ /* Removed for better desktop experience */
        }

        .controls {
            flex-shrink: 0; /* Prevent controls from shrinking */
        }

        .modal-content {
            background-color: #2c2c2c;
            color: #f8f9fa;
            border: 1px solid #444;
            border-radius: 0.5rem;
        }

        .modal-header, .modal-footer {
            border-bottom: 1px solid #444;
            border-top: 1px solid #444;
        }

        .btn-close-white {
            filter: invert(1) grayscale(100%) brightness(200%);
        }
    </style>
</head>
<body class="d-flex align-items-center">

    <!-- Game Modal (for Start, Game Over, Win) -->
    <div class="modal fade" id="gameModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content text-center">
                <div class="modal-header d-flex justify-content-center">
                    <h5 class="modal-title" id="modalTitle">Brick Breaker</h5>
                </div>
                <div class="modal-body">
                    <p id="modalMessage">Use your mouse or finger to move the paddle. Break all the bricks to win!</p>
                </div>
                <div class="modal-footer d-flex justify-content-center">
                    <button type="button" class="btn btn-primary btn-lg" id="modalButton">Start Game</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Game Content -->
    <div class="container-fluid game-container px-0">

        <!-- Info Bar: Level, Score, Lives -->
        <div class="row info-bar mb-2 px-3 ">
            <div class="col-4 text-start">
                Level: <span id="levelDisplay">1</span>
            </div>
            <div class="col-4 text-center">
                Score: <span id="scoreDisplay">0</span>
            </div>
            <div class="col-4 text-end d-flex justify-content-end align-items-center">
                <span class="me-3">Lives: <span id="livesDisplay">3</span></span>
                <i id="soundIcon" class="bi bi-volume-up-fill fs-4" style="cursor: pointer;"></i>
            </div>
        </div>

        <!-- Game Canvas -->
        <div class="row flex-grow-1 game-canvas-container g-0">
            <div class="col-12 p-0 d-flex justify-content-center align-items-center">
                <canvas id="gameCanvas" width="750" height="600"></canvas> <!-- Base resolution -->
            </div>
        </div>

        <!-- Control Buttons -->
        <div class="row controls mt-2 text-center">
            <div class="col-12">
                <button class="btn btn-success mx-2" id="startButton">Start</button>
                <button class="btn btn-warning mx-2" id="pauseButton">Pause</button>
            </div>
        </div>
    </div>

    <!-- Bootstrap 5 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    
    <!-- Tone.js for Sound Effects -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>

    <!-- Game Logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- DOM Elements ---
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            const scoreDisplay = document.getElementById('scoreDisplay');
            const livesDisplay = document.getElementById('livesDisplay');
            const levelDisplay = document.getElementById('levelDisplay');
            const startButton = document.getElementById('startButton');
            const pauseButton = document.getElementById('pauseButton');
            
            const gameModal = new bootstrap.Modal(document.getElementById('gameModal'));
            const modalTitle = document.getElementById('modalTitle');
            const modalMessage = document.getElementById('modalMessage');
            const modalButton = document.getElementById('modalButton');
            const soundIcon = document.getElementById('soundIcon');

            // --- Game State ---
            let score = 0;
            let lives = 3;
            let level = 0;
            const maxLevel = 9; // 10 levels (0-9)
            let gameRunning = false;
            let isPaused = false;
            let ballOnPaddle = true;
            let particles = [];
            let canvasScaleX = 1; // For touch/mouse scaling
            let canvasRect = canvas.getBoundingClientRect();
            let isMuted = false;

            // --- Audio ---
            let audioInitialized = false;
            let sounds = {};

            // Initialize audio context on first user interaction
            function initAudio() {
                if (audioInitialized) return;
                Tone.start();
                sounds.brickHit = new Tone.MembraneSynth({
                    pitchDecay: 0.05, octaves: 4, oscillator: { type: "sine" },
                    envelope: { attack: 0.001, decay: 0.2, sustain: 0.01, release: 0.2 }
                }).toDestination();
                
                sounds.paddleHit = new Tone.Synth({
                    oscillator: { type: "triangle" },
                    envelope: { attack: 0.01, decay: 0.1, sustain: 0, release: 0.1 }
                }).toDestination();

                sounds.wallHit = new Tone.NoiseSynth({
                    noise: { type: 'white' },
                    envelope: { attack: 0.005, decay: 0.05, sustain: 0 }
                }).toDestination();

                sounds.loseLife = new Tone.FMSynth({
                    envelope: { attack: 0.01, decay: 0.5, sustain: 0, release: 0.5 }
                }).toDestination();
                
                sounds.levelUp = new Tone.Synth().toDestination();

                audioInitialized = true;
            }

            // --- Game Objects ---
            const paddle = {
                width: 120,
                height: 20,
                x: (canvas.width / 2) - 60,
                y: canvas.height - 40,
                speed: 10,
                dx: 0
            };

            const ball = {
                x: canvas.width / 2,
                y: canvas.height - 60,
                radius: 10,
                baseSpeedX: 4,
                baseSpeedY: -4,
                dx: 0,
                dy: 0
            };

            // --- Bricks ---
            let bricks = [];
            const brickProps = {
                rows: 5,
                cols: 10,
                width: 75,
                height: 20,
                padding: 5,
                offsetTop: 50,
                offsetLeft: 30
            };
            
            // --- Level Definitions ---
            // 0 = empty, 1 = normal, 2 = hard (2 hits), 3 = indestructible
            const levels = [
                // Level 1
                [
                    [0,0,1,1,1,1,1,1,0,0],
                    [0,1,1,1,1,1,1,1,1,0],
                    [0,0,1,1,1,1,1,1,0,0],
                    [0,0,0,1,1,1,1,0,0,0],
                    [0,0,0,0,1,1,0,0,0,0]
                ],
                // Level 2
                [
                    [1,1,2,2,1,1,2,2,1,1],
                    [1,1,2,2,1,1,2,2,1,1],
                    [1,1,1,1,1,1,1,1,1,1],
                    [0,1,1,1,2,2,1,1,1,0],
                    [0,0,1,1,1,1,1,1,0,0]
                ],
                // Level 3
                [
                    [3,3,3,1,1,1,1,3,3,3],
                    [3,0,1,1,1,1,1,1,0,3],
                    [1,1,1,2,1,1,2,1,1,1],
                    [1,1,1,1,1,1,1,1,1,1],
                    [2,1,1,0,0,0,0,1,1,2]
                ],
                // Level 4
                [
                    [2,2,2,2,2,2,2,2,2,2],
                    [2,1,1,1,1,1,1,1,1,2],
                    [2,1,2,2,2,2,2,2,1,2],
                    [2,1,1,1,1,1,1,1,1,2],
                    [2,2,2,2,2,2,2,2,2,2]
                ],
                // Level 5
                [
                    [0,0,0,3,1,1,3,0,0,0],
                    [0,0,1,1,2,2,1,1,0,0],
                    [0,3,1,2,1,1,2,1,3,0],
                    [1,1,2,1,1,1,1,2,1,1],
                    [1,1,1,1,3,3,1,1,1,1]
                ],
                // Level 6
                [
                    [3,3,3,3,3,3,3,3,3,3],
                    [3,2,2,2,2,2,2,2,2,3],
                    [3,2,1,1,1,1,1,1,2,3],
                    [3,2,1,2,2,2,2,1,2,3],
                    [3,2,1,1,1,1,1,1,2,3]
                ],
                // Level 7
                [
                    [1,1,0,1,1,1,1,0,1,1],
                    [1,2,1,2,1,1,2,1,2,1],
                    [0,1,3,1,3,3,1,3,1,0],
                    [1,2,1,2,1,1,2,1,2,1],
                    [1,1,0,1,1,1,1,0,1,1]
                ],
                // Level 8
                [
                    [3,3,3,3,3,3,3,3,3,3],
                    [0,0,0,0,1,1,0,0,0,0],
                    [0,0,0,2,1,1,2,0,0,0],
                    [0,0,3,1,2,2,1,3,0,0],
                    [0,1,1,1,1,1,1,1,1,0],
                    [2,1,1,1,1,1,1,1,1,2]
                ],
                // Level 9
                [
                    [2,2,3,2,2,2,2,3,2,2],
                    [2,2,3,2,1,1,2,3,2,2],
                    [2,2,3,2,1,1,2,3,2,2],
                    [1,1,3,1,1,1,1,3,1,1],
                    [1,1,1,1,1,1,1,1,1,1],
                    [3,1,1,1,1,1,1,1,1,3]
                ],
                // Level 10
                [
                    [3,1,2,1,3,3,1,2,1,3],
                    [1,2,1,2,1,1,2,1,2,1],
                    [2,1,3,1,2,2,1,3,1,2],
                    [1,2,1,2,1,1,2,1,2,1],
                    [3,1,2,1,3,3,1,2,1,3],
                    [3,3,1,1,1,1,1,1,3,3]
                ]
            ];

            function getBrickColor(type) {
                switch (type) {
                    case 1: return '#0095DD'; // Blue
                    case 2: return '#FFA500'; // Orange
                    case 3: return '#555555'; // Gray
                    default: return '#000';
                }
            }

            function createBricks() {
                bricks = [];
                const levelLayout = levels[level];
                brickProps.rows = levelLayout.length;
                
                for (let r = 0; r < brickProps.rows; r++) {
                    for (let c = 0; c < brickProps.cols; c++) {
                        const brickType = levelLayout[r][c];
                        if (brickType > 0) {
                            bricks.push({
                                x: c * (brickProps.width + brickProps.padding) + brickProps.offsetLeft,
                                y: r * (brickProps.height + brickProps.padding) + brickProps.offsetTop,
                                width: brickProps.width,
                                height: brickProps.height,
                                type: brickType,
                                status: brickType === 2 ? 2 : 1, // 2-hit or 1-hit
                                color: getBrickColor(brickType)
                            });
                        }
                    }
                }
            }

            // --- Particle System ---
            function createParticles(x, y, color) {
                for (let i = 0; i < 15; i++) {
                    particles.push({
                        x: x + brickProps.width / 2,
                        y: y + brickProps.height / 2,
                        radius: Math.random() * 2 + 1,
                        color: color,
                        dx: (Math.random() - 0.5) * 4,
                        dy: (Math.random() - 0.5) * 4 - 2,
                        life: 30, // Frames
                        alpha: 1
                    });
                }
            }

            function updateParticles() {
                for (let i = particles.length - 1; i >= 0; i--) {
                    let p = particles[i];
                    p.x += p.dx;
                    p.y += p.dy;
                    p.dy += 0.1; // Gravity
                    p.life--;
                    p.alpha = p.life / 30;

                    if (p.life <= 0) {
                        particles.splice(i, 1);
                    }
                }
            }
            
            function drawParticles() {
                particles.forEach(p => {
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                    ctx.fillStyle = p.color;
                    ctx.globalAlpha = p.alpha;
                    ctx.fill();
                    ctx.closePath();
                });
                ctx.globalAlpha = 1.0;
            }


            // --- Drawing ---
            function drawPaddle() {
                ctx.beginPath();
                ctx.rect(paddle.x, paddle.y, paddle.width, paddle.height);
                // Gradient for "rich" look
                let gradient = ctx.createLinearGradient(paddle.x, paddle.y, paddle.x + paddle.width, paddle.y);
                gradient.addColorStop(0, '#00bfff');
                gradient.addColorStop(0.5, '#ffffff');
                gradient.addColorStop(1, '#00bfff');
                ctx.fillStyle = gradient;
                ctx.shadowColor = '#00bfff';
                ctx.shadowBlur = 10;
                ctx.fill();
                ctx.closePath();
                ctx.shadowBlur = 0;
            }

            function drawBall() {
                ctx.beginPath();
                ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
                // Radial gradient for 3D effect
                let gradient = ctx.createRadialGradient(ball.x, ball.y, ball.radius * 0.1, ball.x, ball.y, ball.radius);
                gradient.addColorStop(0, '#ffffff');
                gradient.addColorStop(0.8, '#ff4500');
                gradient.addColorStop(1, '#cc0000');
                ctx.fillStyle = gradient;
                ctx.shadowColor = '#ff4500';
                ctx.shadowBlur = 15;
                ctx.fill();
                ctx.closePath();
                ctx.shadowBlur = 0;
            }

            function drawBricks() {
                bricks.forEach(brick => {
                    if (brick.status > 0) {
                        ctx.beginPath();
                        ctx.rect(brick.x, brick.y, brick.width, brick.height);
                        ctx.fillStyle = brick.color;
                        ctx.shadowColor = brick.color;
                        ctx.shadowBlur = 10;
                        ctx.fill();
                        ctx.closePath();
                        
                        // Add a "shine" for 3D effect
                        ctx.beginPath();
                        ctx.moveTo(brick.x, brick.y);
                        ctx.lineTo(brick.x + brick.width, brick.y);
                        ctx.strokeStyle = "rgba(255, 255, 255, 0.5)";
                        ctx.lineWidth = 1;
                        ctx.stroke();
                        ctx.closePath();
                        ctx.shadowBlur = 0;
                    }
                });
            }

            function updateUI() {
                scoreDisplay.textContent = score;
                livesDisplay.textContent = lives;
                levelDisplay.textContent = level + 1;
            }

            // --- Game Logic ---
            function movePaddleTo(newX) {
                paddle.dx = 0; // Stop key-based movement
                paddle.x = newX;
                if (paddle.x < 0) {
                    paddle.x = 0;
                }
                if (paddle.x + paddle.width > canvas.width) {
                    paddle.x = canvas.width - paddle.width;
                }
                if (ballOnPaddle) {
                    ball.x = paddle.x + paddle.width / 2;
                }
            }
            
            function updatePaddlePosition() {
                if (isPaused) return;
                
                paddle.x += paddle.dx;

                // Clamping
                if (paddle.x < 0) {
                    paddle.x = 0;
                }
                if (paddle.x + paddle.width > canvas.width) {
                    paddle.x = canvas.width - paddle.width;
                }
                
                if (ballOnPaddle) {
                    ball.x = paddle.x + paddle.width / 2;
                }
            }

            function launchBall() {
                if (ballOnPaddle) {
                    ball.dx = ball.baseSpeedX;
                    ball.dy = ball.baseSpeedY - (level * 0.25); // Increase speed with level
                    ballOnPaddle = false;
                    if (sounds.paddleHit && !isMuted) sounds.paddleHit.triggerAttackRelease("C4", "8n");
                }
            }

            function moveBall() {
                if (ballOnPaddle) return;

                ball.x += ball.dx;
                ball.y += ball.dy;

                // Wall collision (left/right)
                if (ball.x + ball.radius > canvas.width || ball.x - ball.radius < 0) {
                    ball.dx *= -1;
                    if (sounds.wallHit && !isMuted) sounds.wallHit.triggerAttackRelease("4n");
                }

                // Wall collision (top)
                if (ball.y - ball.radius < 0) {
                    ball.dy *= -1;
                    if (sounds.wallHit && !isMuted) sounds.wallHit.triggerAttackRelease("4n");
                }

                // Wall collision (bottom) - Lose life
                if (ball.y + ball.radius > canvas.height) {
                    loseLife();
                }
            }

            function checkCollisions() {
                // Paddle collision
                if (ball.x > paddle.x &&
                    ball.x < paddle.x + paddle.width &&
                    ball.y + ball.radius > paddle.y) {
                    
                    // Ball is hitting the paddle
                    ball.y = paddle.y - ball.radius; // Prevent sinking
                    
                    // Calculate bounce angle
                    let collidePoint = (ball.x - (paddle.x + paddle.width / 2)) / (paddle.width / 2); // -1 (left) to 1 (right)
                    ball.dx = collidePoint * (Math.abs(ball.baseSpeedX) + level * 0.1); // Angle, slightly faster with level
                    ball.dy = (ball.baseSpeedY - (level * 0.25)); // Base speed + level bonus
                    
                    if (sounds.paddleHit && !isMuted) sounds.paddleHit.triggerAttackRelease("C4", "8n");
                }

                // Brick collision
                let allBricksCleared = true;
                bricks.forEach(brick => {
                    if (brick.status > 0) {
                        if (brick.type !== 3) {
                            allBricksCleared = false; // Found an active, breakable brick
                        }

                        if (ball.x > brick.x &&
                            ball.x < brick.x + brick.width &&
                            ball.y > brick.y &&
                            ball.y < brick.y + brick.height) {
                            
                            if (brick.type !== 3) { // Not indestructible
                                ball.dy *= -1;
                                brick.status--;
                                score += 10;
                                createParticles(brick.x, brick.y, brick.color);
                                
                                if (sounds.brickHit && !isMuted) {
                                    sounds.brickHit.triggerAttackRelease(brick.status === 0 ? "G4" : "C4", "8n");
                                }
                                
                                if (brick.status === 0) {
                                    score += 25; // Bonus for breaking
                                } else if (brick.status === 1) {
                                    brick.color = getBrickColor(1); // Change color on 2-hit
                                }
                            } else {
                                // Indestructible brick collision
                                ball.dy *= -1; // Just bounce
                                if (sounds.wallHit && !isMuted) sounds.wallHit.triggerAttackRelease("2n");
                            }
                            updateUI();
                        }
                    }
                });
                
                if (allBricksCleared) {
                    levelUp();
                }
            }

            function resetBallPaddle() {
                ballOnPaddle = true;
                paddle.x = (canvas.width / 2) - (paddle.width / 2);
                ball.x = canvas.width / 2;
                ball.y = paddle.y - ball.radius;
                ball.dx = 0;
                ball.dy = 0;
            }

            function loseLife() {
                lives--;
                if (sounds.loseLife && !isMuted) sounds.loseLife.triggerAttackRelease("G2", "0.5");
                updateUI();
                if (lives === 0) {
                    gameOver(false); // false = not a win
                } else {
                    resetBallPaddle();
                }
            }
            
            function levelUp() {
                if (level === maxLevel) {
                    gameOver(true); // true = win
                    return;
                }
                
                level++;
                if (sounds.levelUp && !isMuted) sounds.levelUp.triggerAttackRelease("G4", "0.2");
                updateUI();
                createBricks();
                resetBallPaddle();
            }

            function gameOver(didWin) {
                gameRunning = false;
                if (didWin) {
                    modalTitle.textContent = "You Win!";
                    modalMessage.textContent = `Congratulations! You cleared all ${maxLevel + 1} levels. Your final score is: ${score}`;
                    modalButton.textContent = "Play Again";
                } else {
                    modalTitle.textContent = "Game Over";
                    modalMessage.textContent = `Your final score is: ${score}. Better luck next time!`;
                    modalButton.textContent = "Try Again";
                }
                gameModal.show();
            }

            function initGame() {
                initAudio();
                score = 0;
                lives = 3;
                level = 0;
                isPaused = false;
                pauseButton.textContent = "Pause";
                updateUI();
                createBricks();
                resetBallPaddle();
                gameModal.hide();
                gameRunning = true;
                gameLoop(); // Start the loop
            }

            function togglePause() {
                if (!gameRunning) return;
                
                isPaused = !isPaused;
                if (isPaused) {
                    pauseButton.textContent = "Resume";
                } else {
                    pauseButton.textContent = "Pause";
                    gameLoop(); // Resume the loop
                }
            }

            // --- Main Game Loop ---
            function gameLoop() {
                if (!gameRunning || isPaused) return;

                // Clear canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // Draw
                drawBricks();
                drawPaddle();
                drawBall();
                drawParticles();

                // Update
                updatePaddlePosition();
                moveBall();
                checkCollisions();
                updateParticles();
                
                requestAnimationFrame(gameLoop);
            }

            // --- Event Listeners ---
            function handleMove(e) {
                if (isPaused) return;
                
                let clientX = e.clientX || (e.touches ? e.touches[0].clientX : 0);
                let relativeX = (clientX - canvasRect.left) * canvasScaleX;
                
                movePaddleTo(relativeX - paddle.width / 2);
            }
            
            function handleClick(e) {
                if (isPaused) return;
                initAudio(); // Ensure audio is ready
                launchBall();
            }
            
            document.addEventListener('mousemove', handleMove);
            document.addEventListener('touchmove', handleMove, { passive: false });
            
            canvas.addEventListener('click', handleClick);
            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault(); // Prevent screen zoom/scroll
                handleClick(e);
            }, { passive: false });

            startButton.addEventListener('click', () => {
                if (!gameRunning) initGame();
            });
            
            pauseButton.addEventListener('click', togglePause);
            modalButton.addEventListener('click', initGame);

            // --- Key Listeners ---
            function handleKeyDown(e) {
                if (isPaused) return;
                if (e.key === "ArrowRight") {
                    paddle.dx = paddle.speed;
                } else if (e.key === "ArrowLeft") {
                    paddle.dx = -paddle.speed;
                }
            }

            function handleKeyUp(e) {
                if (isPaused) return;
                if (e.key === "ArrowRight" && paddle.dx > 0) {
                    paddle.dx = 0;
                } else if (e.key === "ArrowLeft" && paddle.dx < 0) {
                    paddle.dx = 0;
                }
            }
            document.addEventListener('keydown', handleKeyDown);
            document.addEventListener('keyup', handleKeyUp);

            // --- Sound ---
            function updateSoundIcon() {
                soundIcon.classList.toggle('bi-volume-up-fill', !isMuted);
                soundIcon.classList.toggle('bi-volume-mute-fill', isMuted);
            }

            function toggleMute() {
                isMuted = !isMuted;
                localStorage.setItem('brickBreakerMuted', isMuted);
                updateSoundIcon();
            }

            soundIcon.addEventListener('click', toggleMute);

            // Load mute setting
            const savedMute = localStorage.getItem('brickBreakerMuted');
            if (savedMute === 'true') {
                isMuted = true;
            }
            updateSoundIcon();


            // Handle window resizing
            function onResize() {
                canvasRect = canvas.getBoundingClientRect();
                canvasScaleX = canvas.width / canvasRect.width;
            }
            window.addEventListener('resize', onResize);
            onResize(); // Initial calculation

            // Show initial modal
            gameModal.show();
        });
    </script>
</body>
</html>
